<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>BinVision - Home</title>
    <link rel="icon" href="../static/logo/logo.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="../static/css/style.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  </head>
  <body>
    <div class="sidebar">
      <div id="start"><img src="../static/logo/logoname.ico" alt="Chargement..." width="60%" id="startlogo" /></div>
      <br />
      <a href="/home">Home</a>
      <a href="/"><strong>Settings</strong></a>
      <a href="/dashboard">Dashboard</a>
      <div id="end">
        <p>All rights reserved</p>
        <p>© 2024 BinVision</p>
        <p>Version 1.0.0</p>
      </div>
    </div>

    <div class="content">
        <h3>IA suivi en temps réel</h3>
        <div class="d-flex" style="height: 80vh;">
            <div id="map" style="flex: 3; border: 1px solid #ccc;"></div>
            <div id="sidebar" style="flex: 1; padding: 1rem; border-left: 1px solid #ccc;">
            <h5>Données IA</h5>
            <ul id="log" style="list-style-type: none; padding-left: 0;"></ul>
            </div>
        </div>
    </div>


    <script src="../static/js/script.js"></script>
    <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        const socket = io();
        const map = L.map('map').setView([48.8566, 2.3522], 13); // Paris
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap',
        }).addTo(map);
        const markers = {};
        socket.on('update_marker', data => {
            const { id, lat, lng } = data;
            if (!markers[id]) {
            markers[id] = L.marker([lat, lng]).addTo(map);
            } else {
            markers[id].setLatLng([lat, lng]);
            }
            const logItem = document.createElement("li");
            logItem.textContent = `${id} → ${lat.toFixed(4)}, ${lng.toFixed(4)}`;
            document.getElementById("log").prepend(logItem);
            if (document.getElementById("log").children.length > 10) {
            document.getElementById("log").lastChild.remove();
            }
        });
    </script>
  </body>
</html>
